<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ููุญุฉ ุงูุชุญูู - ุฃุจู ุญุฐููุฉ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>
    body { font-family: 'Cairo', sans-serif; }
    .glass { backdrop-filter: blur(12px); background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); }
    .sidebar { transition: all 0.3s; }
    .sidebar:hover { width: 250px; }
    .nav-link { transition: all 0.2s; }
    .nav-link:hover { background: rgba(0,128,158,0.2); border-radius: 12px; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex">

  <!-- Sidebar -->
  <aside class="sidebar bg-primary-dark text-white w-16 md:w-64 h-screen p-4 fixed">
    <div class="flex items-center space-x-3 space-x-reverse mb-8">
      <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">AH</div>
      <span class="font-bold hidden md:block">ุฃุจู ุญุฐููุฉ</span>
    </div>
    <nav class="space-y-2">
      <a href="#dashboard" class="nav-link p-3 flex items-center space-x-3 space-x-reverse text-sm md:text-base"><span>๐</span> <span class="hidden md:block">ููุญุฉ ุงููุนูููุงุช</span></a>
      <a href="#news" class="nav-link p-3 flex items-center space-x-3 space-x-reverse text-sm md:text-base"><span>๐ฐ</span> <span class="hidden md:block">ุฅุฏุงุฑุฉ ุงูุฃุฎุจุงุฑ</span></a>
      <a href="#rates" class="nav-link p-3 flex items-center space-x-3 space-x-reverse text-sm md:text-base"><span>๐ฑ</span> <span class="hidden md:block">ุฃุณุนุงุฑ ุงูุตุฑู</span></a>
      <a href="#media" class="nav-link p-3 flex items-center space-x-3 space-x-reverse text-sm md:text-base"><span>๐ผ๏ธ</span> <span class="hidden md:block">ููุชุจุฉ ุงููุณุงุฆุท</span></a>
      <a href="#users" class="nav-link p-3 flex items-center space-x-3 space-x-reverse text-sm md:text-base"><span>๐ฅ</span> <span class="hidden md:block">ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู</span></a>
      <a href="#" onclick="logout()" class="nav-link p-3 flex items-center space-x-3 space-x-reverse text-sm md:text-base text-red-200"><span>๐ช</span> <span class="hidden md:block">ุชุณุฌูู ุงูุฎุฑูุฌ</span></a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="mr-16 md:mr-64 p-6 w-full">
    <header class="bg-white glass p-4 rounded-xl shadow mb-6">
      <h1 class="text-2xl font-bold text-primary-dark" id="page-title">ููุญุฉ ุงููุนูููุงุช</h1>
      <p class="text-gray-600">ูุฑุญุจูุงุ <span id="user-greeting">ูุดุฑู</span> | ุฏูุฑู: <span id="user-role" class="text-primary-medium font-semibold"></span></p>
    </header>

    <!-- Dashboard -->
    <section id="dashboard-content">
      <div class="grid md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white glass p-6 rounded-xl text-center">
          <h3 class="text-lg font-bold">ุงูุฃุฎุจุงุฑ</h3>
          <p class="text-3xl font-bold text-primary-medium" id="news-count">...</p>
        </div>
        <div class="bg-white glass p-6 rounded-xl text-center">
          <h3 class="text-lg font-bold">ุงูุฃุณุนุงุฑ</h3>
          <p class="text-3xl font-bold text-primary-medium" id="rates-count">...</p>
        </div>
        <div class="bg-white glass p-6 rounded-xl text-center">
          <h3 class="text-lg font-bold">ุงููุณุชุฎุฏููู</h3>
          <p class="text-3xl font-bold text-primary-medium" id="users-count">...</p>
        </div>
      </div>
    </section>

    <!-- News Management -->
    <section id="news-content" class="hidden">
      <button onclick="addNews()" class="bg-primary-medium text-white px-4 py-2 rounded-lg mb-4">+ ุฅุถุงูุฉ ุฎุจุฑ ุฌุฏูุฏ</button>
      <div id="news-list" class="space-y-4">ุฌุงุฑู ุงูุชุญููู...</div>
    </section>

    <!-- Rates Management -->
    <section id="rates-content" class="hidden">
      <h2 class="text-xl font-bold mb-4">ุชุญุฏูุซ ุฃุณุนุงุฑ ุงูุตุฑู</h2>
      <table class="w-full bg-white glass rounded-xl overflow-hidden">
        <thead class="bg-primary-dark text-white">
          <tr>
            <th class="py-3">ุงูุนููุฉ</th>
            <th class="py-3">ุงูุดุฑุงุก</th>
            <th class="py-3">ุงูุจูุน</th>
            <th class="py-3">ุชุญุฏูุซ</th>
          </tr>
        </thead>
        <tbody id="rates-body">...</tbody>
      </table>
    </section>

    <!-- Users Management -->
    <section id="users-content" class="hidden">
      <h2 class="text-xl font-bold mb-4">ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู</h2>
      <button onclick="addUser()" class="bg-primary-medium text-white px-4 py-2 rounded-lg mb-4">+ ุฅุถุงูุฉ ูุณุชุฎุฏู</button>
      <table class="w-full bg-white glass rounded-xl overflow-hidden">
        <thead class="bg-primary-dark text-white">
          <tr>
            <th class="py-3">ุงุณู ุงููุณุชุฎุฏู</th>
            <th class="py-3">ุงูุฏูุฑ</th>
            <th class="py-3">ุงูุญุงูุฉ</th>
            <th class="py-3">ุฅุฌุฑุงุกุงุช</th>
          </tr>
        </thead>
        <tbody id="users-body">...</tbody>
      </table>
    </section>
  </main>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbww78V6aQa0nk2e2pG-_vVAg2GDsip0qrrX7wS6NIcwZ3W8BgXXqHRStdxh2DC8Rycd/exec";
    const token = localStorage.getItem('adminToken');
    const role = localStorage.getItem('adminRole');

    if (!token) window.location.href = 'admin-login.html';

    document.getElementById('user-greeting').textContent = localStorage.getItem('adminUser') || 'ูุฌููู';
    document.getElementById('user-role').textContent = role;

    // ุชุจุฏูู ุงูุฃูุณุงู
    function showSection(id) {
      document.querySelectorAll('section[id$="-content"]').forEach(s => s.classList.add('hidden'));
      document.getElementById(id + '-content').classList.remove('hidden');
      document.getElementById('page-title').textContent = document.querySelector(`[href="#${id}"]`).textContent.trim();
    }

    // ุชุณุฌูู ุงูุฎุฑูุฌ
    function logout() {
      localStorage.clear();
      window.location.href = 'admin-login.html';
    }

    // ุฌูุจ ุงูุจูุงูุงุช
    async function fetchData(action) {
      const res = await fetch(API_URL + "?action=" + action);
      return await res.json();
    }

    // ุนุฑุถ ุงูุจูุงูุงุช
    window.onload = async () => {
      const news = await fetchData('getNews');
      const rates = await fetchData('getRates');
      const users = await fetchData('getAdmins');

      document.getElementById('news-count').textContent = news.news?.length || 0;
      document.getElementById('rates-count').textContent = rates.rates?.length || 0;
      document.getElementById('users-count').textContent = users.admins?.length || 0;

      // ุนุฑุถ ุงูุฃุณุนุงุฑ
      const ratesBody = document.getElementById('rates-body');
      rates.rates?.forEach(r => {
        ratesBody.innerHTML += `
          <tr>
            <td class="py-3 text-center">${r.Currency}</td>
            <td class="py-3 text-center"><input value="${r.Buy_Sanaa}" class="w-20 text-center border rounded p-1"></td>
            <td class="py-3 text-center"><input value="${r.Sell_Sanaa}" class="w-20 text-center border rounded p-1"></td>
            <td class="py-3 text-center"><button class="bg-green-500 text-white px-2 py-1 rounded text-xs" onclick="updateRate('${r.Currency}', this)">ุญูุธ</button></td>
          </tr>
        `;
      });

      // ุนุฑุถ ุงููุณุชุฎุฏููู
      const usersBody = document.getElementById('users-body');
      users.admins?.forEach(u => {
        usersBody.innerHTML += `
          <tr>
            <td class="py-3">${u.Username}</td>
            <td class="py-3">${u.Role}</td>
            <td class="py-3">${u.Status}</td>
            <td class="py-3">
              <button class="bg-red-500 text-white px-2 py-1 rounded text-xs" onclick="deleteUser('${u.Username}')">ุญุฐู</button>
            </td>
          </tr>
        `;
      });
    };

    function updateRate(currency, btn) {
      // ุณูุชู ุชูููุฐู ูุงุญููุง
      alert('ุณูุชู ุชุญุฏูุซ ุณุนุฑ ' + currency);
    }

    function addUser() {
      alert('ูุธููุฉ ุงูุฅุถุงูุฉ ููุฏ ุงูุชุทููุฑ');
    }

    function addNews() {
      alert('ุฅุถุงูุฉ ุฎุจุฑ ุฌุฏูุฏ');
    }

    function deleteUser(user) {
      if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ' + user + 'ุ')) {
        alert('ุชู ุงูุญุฐู');
      }
    }
  </script>
</body>
</html>
